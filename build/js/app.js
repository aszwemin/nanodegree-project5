function searchResults(e){var a,t,s=e.target.value.toLowerCase(),r=$("#pac-container"),i=function(e,s){t=$(searchElem.replace("%name%",a).replace("%icon%",e)),r.append(t),t.on("click",s),r.css("display","block")};if(r.html(""),r.css("display","none"),""==s)return void reset();for(idx in initialTypes)a=initialTypes[idx],a.toLowerCase().indexOf(s)>-1&&i("pac-icon-search",filterResultsType);for(idx in initialMarkerNames)a=initialMarkerNames[idx],a.toLowerCase().indexOf(s)>-1&&i("pac-icon-marker",filterResultsPlace)}function reset(){markers(initialMarkers),markerNames(initialMarkerNames),setAllMarkers(map),map.setCenter(startingPos),infowindow.close(),types(initialTypes),searchResultsArray(initialSearchResultsArray)}function setAllMarkers(e){var a;for(var t in markers())a=markers()[t],a.setMap(e)}function filterResultsType(e){var a;reset();for(var t in markers())a=markers()[t],-1==a.types.indexOf(e.target.textContent)&&a.setMap(null);searchResultsArray(ko.utils.arrayFilter(initialSearchResultsArray,function(a){return a.type==e.target.textContent})),$(e.target).closest("#pac-container").css("display","none"),document.getElementById("pac-input").value=e.target.textContent}function filterResultsPlace(e){var a=e.target.textContent,t=markerNames.indexOf(a),s=markers()[t],r=s.getPosition();reset(),map.setCenter(r),setInfowindow(s.title,s),searchResultsArray(ko.utils.arrayFilter(initialSearchResultsArray,function(a){return a.name==e.target.textContent})),$(e.target).closest("#pac-container").css("display","none"),document.getElementById("pac-input").value=e.target.textContent}function listElementClicked(){var e;for(var a in markers())if(markers()[a].title==this){e=markers()[a];break}if(e){var t=e.getPosition();map.setCenter(t),setInfowindow(e.title,e)}}function setInfowindow(e,a){var t=a.getPosition();infowindow.setContent("<p><b>"+e+'</b></p><img src="https://maps.googleapis.com/maps/api/streetview?size=150x150&location='+t.lat()+","+t.lng()+'&key=AIzaSyAQQKdRYZeSSDMm9Lrh98wDAmGEzQ8mB8U">'),t.D=a.posD,infowindow.setPosition(t),infowindow.open(map,a),google.maps.event.addListener(infowindow,"closeclick",function(){searchResultsArray(initialSearchResultsArray),map.setCenter(startingPos),document.getElementById("pac-input").value=""})}function createMarker(e){var a=e.geometry.location,t={url:e.icon,size:new google.maps.Size(71,71),scaledSize:new google.maps.Size(25,25),origin:new google.maps.Point(0,0),anchor:new google.maps.Point(17,34)},s=new google.maps.Marker({map:map,position:a,title:e.name,icon:t,posD:a.D-5e-4,types:e.types});markers.push(s),initialMarkers.push(s),markerNames.push(e.name),initialMarkerNames.push(e.name),google.maps.event.addListener(s,"click",function(){var a=this.getPosition();map.setCenter(a),searchResultsArray(ko.utils.arrayFilter(initialSearchResultsArray,function(a){return a.name==e.name})),setInfowindow(e.name,this)})}function processDetails(e,a){var t,s=function(e){return{name:e.name,address:e.formatted_address,phone:e.international_phone_number,icon:e.icon,url:e.url,reviews:e.reviews,type:e.types[0]}};t=s(a==google.maps.places.PlacesServiceStatus.OK?e:this),initialSearchResultsArray.push(t),initialSearchResultsArray.sort(function(e,a){return e.address&&a.address?0:e.address?-1:1}),searchResultsArray(initialSearchResultsArray)}function processPlaces(e,a){if(setAllMarkers(null),markers([]),a==google.maps.places.PlacesServiceStatus.OK)for(var t=0;t<e.length;t++)createMarker(e[t]),service.getDetails({placeId:e[t].place_id},processDetails.bind(e[t]))}function getPlaces(e){var a={location:startingPos,radius:500,types:types()};service=new google.maps.places.PlacesService(e),service.nearbySearch(a,processPlaces),searchResultsArray([])}function initialize(){var e={center:{lat:-36.8618,lng:174.7621},zoom:16};map=new google.maps.Map(document.getElementById("map-canvas"),e),infowindow=new google.maps.InfoWindow,getPlaces(map),$("#pac-input").on("input",searchResults),ko.applyBindings(searchResultsArray)}var map,infowindow,startingPos=new google.maps.LatLng(-36.8618,174.7621),initialTypes=["art_gallery","book_store","museum","movie_theater","stadium","university","police"],initialMarkers=[],initialMarkerNames=[],markers=ko.observableArray(),markerNames=ko.observableArray(),types=ko.observableArray(initialTypes),searchElem='<div class="pac-item"><a href="#"><span class="pac-icon %icon%"></span><span class="pac-item-query"><span class="pac-matched">%name%</span></span><span></span></a></div>',service,initialSearchResultsArray=[],searchResultsArray=ko.observableArray();google.maps.event.addDomListener(window,"load",initialize);